<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ğŸ“ æ–‡ä»¶ç®¡ç†</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; padding: 20px; max-width: 900px; margin: 0 auto; background: #fafafa; }
    h1 { color: #333; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    th, td { padding: 14px 16px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #f5f5f5; font-weight: 600; }
    .actions a { color: #d32f2f; text-decoration: none; font-weight: 500; }
    .actions a:hover { text-decoration: underline; }
    .size { color: #666; }
    .time { color: #999; font-size: 0.85em; }
  </style>
</head>
<body>
  <h1>ğŸ“ å·²ä¸Šä¼ æ–‡ä»¶ï¼ˆ<span id="count">0</span>ï¼‰</h1>
  <table id="fileTable">
    <thead>
      <tr>
        <th>æ–‡ä»¶å</th>
        <th>å¤§å°</th>
        <th>ä¸Šä¼ æ—¶é—´</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const serviceUrl = window.location.host;

    function formatSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      else if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      else return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    async function loadFiles() {
      try {
        const res = await fetch(`http://${serviceUrl}/api/files`);
        const files = await res.json();
        const tbody = document.querySelector('#fileTable tbody');
        tbody.innerHTML = '';

        files.forEach(f => {
          const tr = document.createElement('tr');
          const time = new Date(f.uploaded).toLocaleString('zh-CN');
          tr.innerHTML = `
            <td><a href="http://${serviceUrl}${f.url}" target="_blank">${f.name}</a></td>
            <td class="size">${formatSize(f.size)}</td>
            <td class="time">${time}</td>
            <td class="actions">
              <a href="#" onclick="deleteFile('${f.savedName}'); return false;">ğŸ—‘ï¸ åˆ é™¤</a>
            </td>
          `;
          tbody.appendChild(tr);
        });

        document.getElementById('count').textContent = files.length;
      } catch (e) {
        console.error(e);
        alert('åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥');
      }
    }

    async function deleteFile(savedName) {
      if (!confirm('ç¡®å®šåˆ é™¤æ­¤æ–‡ä»¶ï¼Ÿåˆ é™¤åä¸å¯æ¢å¤ã€‚')) return;
      try {
        await fetch(`http://${serviceUrl}/api/files/${savedName}`, {
          method: 'DELETE'
        });
        loadFiles();
      } catch (e) {
        alert('åˆ é™¤å¤±è´¥');
      }
    }

    loadFiles();
  </script>
</body>
</html>
